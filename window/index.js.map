{"version":3,"sources":["index.js"],"names":["HorizontalCarousel","carousel_element","el_prev","removeEventListener","private_handle_click_prev","el_next","private_handle_click_next","el_images","private_handle_images_scroll","window","private_handle_window_resize","carousel","querySelector","private_add_arrows","private_fix_arrows","prev","next","images","addEventListener","debounce","scrollBy","left","clientWidth","top","behavior","setTimeout","slides","insertAdjacentHTML","last_slide","scrollLeft","style","opacity","visibility","scrollWidth","querySelectorAll","length","last_image","complete","private_init_carousel","onload","callback","wait","timeout","callNow","arguments","clearTimeout","horizontal_carousel","horizontal_carousels","elements","refs","el","push","module","exports"],"mappings":"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","file":"index.js","sourceRoot":"../cjs","sourcesContent":["'use strict';\n\nclass HorizontalCarousel {\n  /*\n   * To be called in React componentDidMount or similar,\n   * after carousel div has been loaded into the DOM.\n   * componentDidMount(){\n   *    // See React documentation about how to use refs.\n   *    this.carousel = new horizontal_carousel(this.ref.current)\n   * }\n   * or\n   * <script>\n   *    window.myCarousel = new horizontal_carousel(window.querySelector('#myCarousel')\n   * </script>\n   */\n  constructor(carousel_element) {\n    this.carousel = carousel_element;\n    /*\n     * Wait for the images to load, then init.\n     */\n    if (this.carousel) {\n      let images = this.carousel.querySelectorAll(\"img\");\n      if (images && images.length) {\n        /*\n         * Find last image in last carousel - wait for it to finish loading.\n         */\n        let last_image = images[images.length - 1];\n        if (last_image && last_image.complete) {\n          /*\n           * Image is already loaded - probably from browser cache\n           */\n          this.private_init_carousel();\n        } else {\n          /*\n           * Wait for image to finish loading\n           */\n          last_image.onload = this.private_init_carousel;\n        }\n      } else {\n        /*\n         * No images - fire up that carousel immediately!\n         */\n        this.private_init_carousel();\n      }\n    }\n  }\n  /*\n   * Important in an SPA like React. Call .end() when componentWillUnmount()\n   * This stops event listeners which were started: el.click, window.scroll, window.resize.\n   * componentWillUnmount(){\n   *    this.carousel.end()\n   * }\n   * or\n   * <script>\n   *    window.myCarousel.end()\n   * </script>\n   */\n  end = () => {\n    this.el_prev && this.el_prev.removeEventListener(\"click\", this.private_handle_click_prev);\n    this.el_next && this.el_next.removeEventListener(\"click\", this.private_handle_click_next);\n    this.el_images && this.el_images.removeEventListener(\"click\", this.private_handle_images_scroll);\n    window.removeEventListener(\"click\", this.private_handle_window_resize);\n  };\n\n  /**\n   * INITIATE THE CAROUSELS\n   *    Run script to bring the carousel to life\n   */\n  private_init_carousel = () => {\n    let { carousel } = this;\n    // add arrows if not exist\n    let arrows = carousel.querySelector(\".arrows\");\n    if (!arrows) {\n      this.private_add_arrows(carousel);\n    }\n    // fix arrows (show/hide left/right)\n    this.private_fix_arrows();\n    // dependents\n    let prev = (this.el_prev = carousel.querySelector(\".prev\"));\n    let next = (this.el_next = carousel.querySelector(\".next\"));\n    let images = (this.el_images = carousel.querySelector(\".slides\"));\n    // prev/next\n    next.addEventListener(\"click\", this.private_handle_click_next);\n    prev.addEventListener(\"click\", this.private_handle_click_prev);\n\n    /*\n     * IMPORTANT: on manual user scroll, fix arrows\n     */\n    images.addEventListener(\"scroll\", this.private_handle_images_scroll);\n    // and on window resize, also fix arrows\n    window.addEventListener(\"resize\", this.private_handle_window_resize);\n  };\n  private_handle_images_scroll = () => {\n    debounce(this.private_fix_arrows, 100)();\n  };\n  private_handle_window_resize = () => {\n    debounce(this.private_fix_arrows, 200)();\n  };\n  private_handle_click_next = () => {\n    let { el_images } = this;\n    // smooth scroll to next frame\n    el_images.scrollBy({ left: el_images.clientWidth, top: 0, behavior: \"smooth\" });\n    // not sure how long the animation will take:\n    setTimeout(this.private_fix_arrows, 500);\n    setTimeout(this.private_fix_arrows, 750);\n  };\n  private_handle_click_prev = () => {\n    let { el_images } = this;\n    // smooth scroll to next frame\n    el_images.scrollBy({ left: -el_images.clientWidth, top: 0, behavior: \"smooth\" });\n    // not sure how long the animation will take:\n    setTimeout(this.private_fix_arrows, 500);\n    setTimeout(this.private_fix_arrows, 750);\n  };\n  /**\n   * ADD ARROW ELEMENTS (prev/next buttons)\n   */\n  private_add_arrows = () => {\n    let { carousel } = this;\n    let arrows = `\n    <div class=\"arrows\">\n      <svg class=\"prev\" viewBox=\"8 8 192 512\">\n        <defs><filter id=\"shadow\"><feDropShadow dx=\"5\" dy=\"10\" stdDeviation=\"5\" flood-color=\"black\" /></filter></defs>\n        <path fill=\"currentColor\" stroke=\"white\" stroke-width=\"18\" d=\"M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z\"></path>\n      </svg>\n      <svg class=\"next\" viewBox=\"-8 -8 192 512\"\n        <defs><filter id=\"shadow\"><feDropShadow dx=\"5\" dy=\"10\" stdDeviation=\"5\" flood-color=\"black\" /></filter></defs>\n        <path fill=\"currentColor\" stroke=\"white\" stroke-width=\"18\" d=\"M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z\"></path>\n      </svg>\n    </div>\n    `;\n    // insert after slides\n    let slides = carousel.querySelector(\".slides\");\n    if (!slides) return;\n    // Mozilla says this does not corrupt existing elements, so should work with React:\n    slides.insertAdjacentHTML(\"afterend\", arrows);\n  };\n  /**\n   * Hide left/right arrows when scrolled all the way left/right.\n   */\n  private_fix_arrows = () => {\n    let { carousel } = this;\n    let prev = carousel.querySelector(\".prev\");\n    let next = carousel.querySelector(\".next\");\n    let slides = carousel.querySelector(\".slides\");\n    let last_slide = carousel.querySelector(\".slides > *:last-child\");\n    if (slides.scrollLeft === 0) {\n      /*\n       * scrolled all the way left\n       */\n      prev.style.opacity = 0;\n      prev.style.visibility = \"hidden\";\n    } else {\n      prev.style.opacity = 1;\n      prev.style.visibility = \"visible\";\n    }\n    if (slides.scrollLeft + slides.clientWidth >= slides.scrollWidth - last_slide.clientWidth / 2) {\n      /*\n       * scrolled all the way right (allow last child to be half cut-off)\n       */\n      next.style.opacity = 0;\n      next.style.visibility = \"hidden\";\n    } else {\n      next.style.opacity = 1;\n      next.style.visibility = \"visible\";\n    }\n  };\n}\n\n/*\n *\n * HELPER LIB:\n *\n */\nfunction debounce(callback, wait) {\n  let timeout = null;\n  return function () {\n    const callNow = !timeout;\n    const next = function () {\n      return callback(arguments);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(next, wait);\n    if (callNow) {\n      next();\n    }\n  };\n}\n\n/*\n *\n * EXPORT FOR BROWSER:\n *\n */\n/*\n * Init one carousel (as a class, use \"new\"):\n * <script>\n *    let myCar = new horizontal_carousel(document.querySelectorAll('.mycarousel'))\n *    // then, optionally, to remove event listeners:\n *    myCar.end()\n * </script>\n *\n * Init multiple carousels (as a function, without \"new\"):\n * <script>\n *    let refs = horizontal_carousels(document.querySelectorAll('.mycarousel'))\n *    // then, optionally, to remove event listeners:\n *    for (let ref of refs) { ref.end(); }\n * </script>\n */\nif (typeof window === \"object\") {\n  window.horizontal_carousel = HorizontalCarousel;\n  window.horizontal_carousels = function (elements) {\n    let refs = [];\n    if (elements && elements.length) {\n      for (let el of elements) {\n        refs.push(new HorizontalCarousel(el));\n      }\n    }\n    return refs;\n  };\n}\n\nmodule.exports = HorizontalCarousel;\n"]}